!function(e){"use strict";function t(e){return new RegExp("^"+e+"$")}function n(e,t){var n=e.proxy[t];n&&delete n.memo}var i="app",r="value",s="$deps",o="$$",a="$",u="_calc_fn",c="_val_fn",l=null,d=function(e,t){return[].slice.call(e,t)},f=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)},h={debugEnabled:!1,isUndefined:function(e){return void 0==e},isDefined:function(e){return void 0!=e},isObject:function(e){return null!=e&&"object"==typeof e},isString:function(e){return"string"==typeof e||"[object String]"=={}.toString.apply(e)},isNumber:function(e){return"number"==typeof e||"[object Number]"=={}.toString.apply(e)},isDate:function(e){return"[object Date]"=={}.toString.apply(e)},isRegExp:function(e){return"[object RegExp]"=={}.toString.apply(e)},isUID:function(e){return this.isString(e)&&/[0-9A-Ha-h]{8}-[0-9A-Ha-h]{4}-[0-9A-Ha-h]{4}-[0-9A-Ha-h]{4}-[0-9A-Ha-h]{12}/.test(e)},isArray:function(e){return Array.isArray(e)||"[object Array]"=={}.toString.apply(e)},isCollection:function(e){var t={}.toString.apply(e);return this.isArray(e)||e instanceof Array||"[object NodeList]"==t||"[object NamedNodeMap]"==t||"[object Arguments]"==t},isFunction:function(e){return"function"==typeof e},isBoolean:function(e){return"boolean"==typeof e||"[object Boolean]"=={}.toString.apply(e)},isHandle:function(e){return e&&0==e.indexOf(a)},isDependency:function(e){return e&&0==e.indexOf(o)},isEnumerable:function(e){return e&&!this.isHandle(e)&&"_"!=e.charAt(0)},trim:function(e){return this.isString(e)?e.trim():e},lowercase:function(e){return this.isString(e)?e.toLowerCase():e},uppercase:function(e){return this.isString(e)?e.toUpperCase():e},toInt:function(e){return parseInt(e,10)},toFloat:function(e){return parseFloat(e)},eqi:function(e,t){return this.lowercase(e)===this.lowercase(t)},isEqual:function(e,t){if(e===t)return!0;if(this.isUndefined(e)||null==e||this.isUndefined(t)||null==t)return!1;if(typeof e!=typeof t)return!1;if(this.isDate(e)&&this.isDate(t))return e.getTime()===t.getTime();if(this.isRegExp(e)&&this.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(this.isFunction(e)&&this.isFunction(t))return e.toString()==t.toString();if(!this.isObject(e)&&!this.isObject(t))return e==t;if(e.prototype!==t.prototype)return!1;try{var n=Object.keys(e),i=Object.keys(t);if(n.length!=i.length)return!1;n.sort(),i.sort();var r;for(r=n.length-1;r>=0;r--)if(n[r]!=i[r])return!1;var s;for(r=n.length-1;r>=0;r--)if(s=n[r],!this.isEqual(e[s],t[s]))return!1}catch(o){return!1}return!0},clone:function(e){if(!e||!this.isObject(e))return e;var t=this.isCollection(e)?[]:Object.create(Object.getPrototypeOf(e));return t=this.extend(t,e,function(e){return h.clone(e)})},convert:function(e,t){var n=e,i=function(e,n){return h.isObject(t)&&h.isString(n)&&0==n.indexOf("#{")&&n.indexOf("}"==n.length-1)?t[n.substring(2,n.length-1)]:n};return"true"===e?n=!0:"false"===e?n=!1:/^\d+$/.test(e)?n=e.contains(".")?this.toFloat(e):this.toInt(e):"["==e[0]&&"]"==e[e.length-1]?(e=e.replace(/'/g,'"'),n=JSON.parse(e,i)):"{"==e[0]&&"}"==e[e.length-1]?(e=e.replace(/'/g,'"'),n=JSON.parse(e,i)):('"'==e[0]||"'"==e[0])&&(n=e.substring(1,e.length-1)),n},forEach:function(e,t,n,i){if(n||(n=this),t)if(this.isCollection(e)){var r=-1,s=e.length,o=[];for(o=i?[].slice.call(e):e;++r<s&&t.call(n,o[r],r,o)!==!1;);}else t.call(n,e,0,[e]);return e},forIn:function(e,t,n,i){if(n||(n=this),t)for(var r in e)if((e.hasOwnProperty(r)||i)&&t.call(n,e[r],r,e)===!1)break;return e},safeCall:function(e,t){var n,i=2;try{var r=d(arguments,i);n=e.apply(t,r)}catch(s){n=void 0,(!this.isFunction(t.$ready)||t.$ready())&&(console.error("Is ready and had an error:"+s.message),console.log(s.stack),h.debug(s,"User code error"))}return n},define:function(e,t,n,i){this.defineImmutable(e,"$name",t),this.defineImmutable(e,"$sealed",n||!1),this.defineImmutable(e,"$deps",Object.freeze(i||[])),this.defineImmutable(e,"_uid",this.uid())},defineImmutable:function(e,t,n){Object.defineProperty(e,t,{value:n,configurable:!1,writable:!1,enumerable:!0,_proxyMark:!0})},uid:function(){return f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f()},extend:function(e,t,n){return this.isCollection(e)&&this.isCollection(t)?this.forEach(t,function(t,i){[].push.call(e,n?n(t,i):t)}):this.forIn(t,function(t,i){e[i]=n?n(t,i):t},this),e},nextTick:function(t){"function"==typeof e.setImmediate?e.setImmediate(t):"undefined"!=typeof process&&process.nextTick?process.nextTick(t):e.setTimeout(t,0)},debug:function(e,t){this.debugEnabled&&(t&&console.groupCollapsed&&(console.groupEnd(),console.groupCollapsed(t)),console.log(e))}},p={},v=function(e,t,n,i){var r=p[e];if(h.isUndefined(t))return r;if(r&&r.$sealed)throw new Error(e+" pipe already registered and sealed. Please choose another name for your pipe");if(!e||"."==e[0])throw new Error(e+" is not valid name for your pipe");return r=g(e,t,n||[]),h.define(r,e,i,n),r=h.extend(r,h),h.defineImmutable(r,"$async",3==t.length),p[e]=r,h.debug("Pipe was registered "+e),r},g=function(e,t,n){var i=function(r,s,a){if(h.debug("Process pipe "+e),h.forEach(n,function(e){i[o+e]=p[e]}),h.isString(s)&&s.length>0){var u=h.convert(s,r);s=[],h.forEach(u,function(e){e=h.trim(e),s.push(e)})}return t&&h.isFunction(t)&&(r=h.safeCall(t,i,r,s,a)),h.debug("Ready pipe "+e),r};return i},y=function(e){return h.isString(e)?e=p[e]:h.isFunction(e)&&(e=v("%tmp%",e)),e},m=function(e){return $(e),b(e)},b=function(e){function t(){var e=n.shift();return function(t){h.nextTick(function(){e&&e(t)})}}var n=[],i=!1,r=function(){if(0==arguments.length)return e;var s=arguments[0];if(s=y(s),!s)throw new Error("Pipe "+arguments[0]+" not found");var o=d(arguments,1),a=function(n){e=n;var i=t();s.$async?s(e,o,i):(e=s(e,o),i(e))};return n.push(a),s.$async||i?(i||t()(e),i=!0):e=s(e,o),r};return r},$=function(e){var t=new j(e);t.apply=function(t,n){if(h.isHandle(t)){var i=t.substring(1),r=x[i];if(r){h.debug("Check handle "+i);var s=e[t],o=l?l.obj[i]:void 0;h.isUndefined(s)&&h.isDefined(o)&&(s=o),h.debug("Got handle config "+s),h.isDefined(s)&&(this.remove(r._uid),e._silent=!0,e[t]=r(e,s,this,o),delete e._silent)}}t&&this.onChange(t,n)},t.observe()},E=function(e,t,n){e=h.trim(e||"");var i=e.split("|"),r=i[0],s=r.indexOf(".");-1!=s?(i[0]=r.substring(s),r=r.substring(0,s)):i=i.splice(1);var o=n;if(n){if(n.$name){var a=H[n.$name];a&&(n=a.observer.unbind(n))}n=m(n)}else n=P(r);return h.forEach(i,function(e){var t=E.prototype.parse(e,o),i=[t.name];i=h.extend(i,t.params),h.debug("Parsed pipe"+JSON.stringify(i)),n=n.apply(n,i)}),h.isFunction(t)?n.apply(n,[t]):n()};E.prototype={parse:function(e,t){var n=e.indexOf(":"),i={},r=-1!=n;if(i.name=h.trim(r?e.substr(0,n):e),i.params=[],"."==i.name.charAt(0)&&(i.params=[i.name.substring(1)],i.name="property",n=-1),r){var s=h.trim(e.substr(++n));s="["+s+"]";var o=h.convert(s,t);h.forEach(o,function(e){e=h.trim(e),i.params.push(e)})}return i}};var x={},w=function(e,t,n,i){var r=x[e];if(h.isUndefined(t))return r;if(r&&r.$sealed)throw new Error(e+" handle already registered and sealed. Please choose another name for your handle");return r=C(e,t,n||[]),h.define(r,e,i,n),r=h.extend(r,h),x[e]=r,r},C=function(e,t,n){var i=function(r,s,a,u){return h.debug("Process handle "+e),h.forEach(n,function(e){i[o+e]=x[e]}),t&&h.isFunction(t)&&(s=h.safeCall(t,i,r,s,a,u)),h.debug("Processed handle "+e),s};return i},_=function(){this.$prop=function(e,t){for(var n=this,i=e.split("."),r=1,s=i.length;s>r;)if(n=n[i[r-1]],r++,h.isUndefined(n))return void 0;var o=i[s-1];return h.isUndefined(t)?n[o]:(n[o]=t,void 0)},this.$ready=function(){return h.isDefined(this._ready)?this._ready:(this._ready=!0,h.forEach(this.$deps,function(e){var t=this[o+e];return!t||t._empty?(this._ready=!1,!1):!0},this),this._ready)}};_.prototype=h;var A=function(e){h.extend(this,e)};A.prototype=new _;var j=function(e){this.obj=e,this.props=[],this.listeners=[],this.deps={},this.proxy={}};j.prototype={unbind:function(e,t){e||(e=this.obj);var n=Object.create(Object.getPrototypeOf(e));return h.forIn(e,function(e,i){var r=t?t+"."+i:i,s=this.proxy[r],o=s?s.value:e;n[i]=h.isObject(e)?this.unbind(o,i):o},this),n},observe:function(){var e=this.obj;h.debug("Exploring object "+e.$name);var t=D(e,this);h.forEach(this.props,function(e){h.debug("Check for property being deleted "+e),h.isUndefined(this.obj.$prop(e))&&(h.debug("Notify deleted property "+e),this.onDelete(e))},this),this.props=t},watch:function(e,n,i,r){if(e&&"*"!==e||(e=".*"),h.debug("Dynamic property listener: "+e),i||r){var s=O(t(e),n,i,r);return this.listeners.push(s),function(){this.listeners.remove(s)}.bind(this)}return null},observeArray:function(e,t,n,i){if(h.isArray(e)||(e=[e]),!t)throw"Change function need to be implemented";return h.forEach(["push","unshift"],function(t){e[t]=function(){var i=[].map.call(arguments,function(t){return n?h.safeCall(n,e,t):t});return[][t].apply(e,i)}}),h.forEach(["pop","shift"],function(t){e[t]=function(){var n=[][t].call(e);return i?h.safeCall(i,e,n):n}}),h.forEach(["sort","reverse","splice"],function(t){e[t]=function(){var n=[][t].call(e,arguments);return"splice"===t&&(n=n.map(function(t){return i?h.safeCall(i,e,t):t})),this.check(),n}}),e._cmp=function(i,r,s){h.isUndefined(s)?this[i]=h.safeCall(n,e,r):h.isEqual(r,s)||(this[i]=h.safeCall(t,e,r,s,i))},e.set=function(e,t){var n=this[e];this._cmp(e,t,n)},e.check=function(){h.forEach(this,function(e,t){var n=this._copy[t];this._cmp(t,e,n)},this),this.memo()},e.memo=function(){this._copy=h.extend({},this)},e.memo(),h.debug("Array observer bound"),e},remove:function(e){h.isString(e)&&h.forEach(this.listeners,function(t,n){var i=t.property;e&&(i===e||t.handlerId===e||!h.isUID(e)&&h.isRegExp(i)&&i.test(e))&&this.listeners.splice(n,1)},this,!0)},onChange:function(e){return h.debug("Property change: "+e),I(e,this,"change")},onDelete:function(e){return h.debug("Property delete: "+e),I(e,this,"del")},apply:function(e){this.onChange(e)}};var O=function(e,t,n,i){return{property:e,handlerId:t,onChange:n,onDelete:i}},S=function(e,t,i){n(i,t),h.forIn(i.deps,function(e,s){h.isDependency(t)&&h.isEqual(e,[r])?(n(i,s),i.onChange(s)):h.forEach(e,function(e){e===t&&s!=t&&(n(i,s),i.onChange(s))})})},I=function(e,t,n){var i=t.obj;S(i,e,t),h.debug("React on "+n+" for "+e);var r=i.$prop(e);return h.forEach(t.listeners,function(t){if(h.isDefined(t)){var s=t.property,o=h.isRegExp(s)&&s.test(e);if(o){var a="del"===n?t.onDelete:t.onChange;h.isFunction(a)&&(r=h.safeCall(a,i,i,e,r))}}}),r},D=function(e,t,n){var r=[];return h.forIn(e,function(a,u){if("prototype"==u)return!0;var c=Object.getOwnPropertyDescriptor(e,u);if(c._proxyMark)return!0;if(!c.configurable||void 0===c.value&&!c.set||c.writable===!1)return!0;var l=h.isDependency()&&-1!=e.$deps.indexOf(u.substring(2)),d=n?n+"."+u:u;return!h.isObject(a)||h.isArray(a)||l||u==s||u===o+i||(h.debug("Exploring object "+u),h.extend(r,D(a,t,d))),h.debug("Observing property "+u),T(e,u,c,t,d)&&(r.push(u),t.onChange(d)),!0}),r},T=function(e,t,n,i,s){var o=i[s];if(h.isDefined(o))return!1;o={get:n.get,set:n.set,value:n.value,memo:n.memo};var a=function(){var e;if(e=o.get?o.get.call(this):o.value,h.isString(e)&&0==e.indexOf("#{")&&e.indexOf("}")==e.length-1){var t=e.substring(2,e.length-1)||r;e=function(){return this.$prop(t)}.val(t)}return h.isFunction(e)&&(e.$name==c?h.isUndefined(o.memo)?(i.deps[s]=e.$deps,e=o.memo=h.safeCall(e,i.obj)):e=o.memo:e.$name==u&&(e=h.safeCall(e,i.obj))),e},l=function(e){(h.isDependency(t)||!h.isEqual(o.value,e))&&(o.set?o.set.call(this,e):o.value=e,l._apply||this._silent||(l._apply=!0,i.apply(s),l._apply=!1))};a.call(e);var d=n.enumerable;return Object.defineProperty(e,t,{get:a,set:l,configurable:!0,enumerable:d}),i.proxy[s]=o,!0},R=function(e,t){this.name=e,this.reliers=[],this.processedHandles=[],this.applyCount=0,this.obj=t,this.observer=new j(t);var n=this;this.observer.apply=function(e){n.apply(e)}};R.prototype={apply:function(e){var t=this.name;if(h.debug("Calling apply on '"+t+"' after changed property '"+e+"'"),h.isHandle(e)){var n=e.substring(1),r=x[n];r&&t!==i&&this.resolveHandle(this.obj,n,r)}e&&this.observer.onChange(e),h.forEach(this.reliers,function(e){var s=H[e];s&&(r&&t===i&&this.resolveHandle(s.obj,n,r),s.obj[o+t]=this.obj,delete s.obj._ready)},this)},resolveHandles:function(){var e=this.name,t=this.obj;e!==i&&(this.processedHandles=[],h.forIn(x,function(e,n){this.processedHandles.contains(n)||this.resolveHandle(t,n,e)},this))},resolveHandle:function(e,t,n){h.debug("Check handle "+t),h.forEach(n.$deps,function(t){if(!this.processedHandles.contains(t)){var n=x[t];n&&this.resolveHandle(e,t,n)}},this);var i=a+t,r=e[i],s=l?l.obj[i]:void 0;h.isUndefined(r)&&h.isDefined(s)&&(r=s),h.debug("Got handle config "+r),h.isDefined(r)&&(this.observer.remove(n._uid),e._silent=!0,e[i]=n(e,r,this.observer,s),delete e._silent),this.processedHandles.contains(t)||this.processedHandles.push(t)},checkApplyCount:function(){if(this.applyCount++,this.applyCount>10&&h.debug("Too many apply :"+this.name+" - "+this.applyCount),!this.timeout){var e=this;this.timeout=setTimeout(function(){e.timeout=null,e.applyCount=0},3e3)}}};var H={},P=function(e,t,n,r){e!=i&&null==H[i]&&P(i,{});var s=H[e];if(h.isUndefined(t))return m(s.observer.unbind());if(s&&s.obj.$sealed)throw new Error(e+" tie is already registered and sealed. Please choose another name for your tie");return s=P.prototype.init(e,t,n,r),P.prototype.define(e,s),e==i&&(l=s),s.obj};if(P.prototype={check:function(e){return(h.isFunction(e)||h.isArray(e)||h.isRegExp(e)||h.isBoolean(e)||h.isNumber(e)||h.isString(e)||h.isDate(e)||!h.isObject(e))&&(e={value:e}),new A(e)},resolveApp:function(e){var t=e.name;t!=i&&(e.obj[o+i]=l.obj,l.reliers.contains(t)||l.reliers.push(t))},resolveDependencies:function(e,t){var n=e.name;t&&h.forEach(t,function(t){h.debug("Check dependency "+t);var i=H[t];i||(h.debug("Dependency stub "+t),i={name:t,reliers:[],obj:{_empty:!0}},this.define(t,i)),e.obj[o+t]=i.obj,delete e.obj._ready,i.reliers.contains(n)||i.reliers.push(n)},this)},define:function(e,t){var n=H[e];H[e]=t,n&&(n.obj._deleted=!0,n.reliers&&(t.reliers=n.reliers,h.debug("Calling apply on '"+t.name+"' after define"),t.apply("*")))},init:function(e,t,n,i){h.debug("Tie "+e,e);var r=this.check(t),s=new R(e,r);return h.define(r,e,i,n),r._deleted=!1,this.resolveApp(s),s.resolveHandles(),this.resolveDependencies(s,n),s.observer.observe(),h.debug("Bind model ready"),s}},Function.prototype.val=function(e){return h.isDefined(e)&&!h.isArray(e)&&(e=[e]),h.define(this,c,!1,e||[r]),this},Function.prototype.calc=function(){return h.define(this,u,!1),this},Array.prototype.contains=function(e){return-1!=this.indexOf(e)},Array.prototype.remove=function(e){var t=this.indexOf(e);return-1!=t?this.splice(t,1):[]},String.prototype.prop=function(){var e=this||r;return"#{"+e+"}"},String.prototype.contains=function(e){return-1!=this.indexOf(e)},String.prototype.contains=function(e){return-1!=this.indexOf(e)},e.tie=P,e.tie.pipe=v,e.tie.handle=w,e.tie.enableDebug=function(e){h.debugEnabled=e},e.tie.$=E,e.tie._=h,"object"==typeof e.exports){var k=e.tie;global.test&&(k.tier=P.prototype,k.model=A,k.ties=H,k.pipesRegistry=p,k.handlesRegistry=x,k.bind=R),e.exports=k}v("property",function(e,t){if(t&&t.length>0){var n=t[0],i=t.length>1?t[1]:r;e.$prop(i,e.$prop(n))}return e}),v("value",function(e,t){if(t&&t.length>0){var n=t[0],i=t.length>1?t[1]:null;e.$prop(n,i)}return e}),w("require",function(t,n){return h.isFunction(e.require)?e.require(n):console.error("Require is undefined"),n})}("object"==typeof exports?module:window),function(e){"use strict";var t=e.document,n=e.tie._,i=e.tie.$,r="$",s="$$",o="value",a="text",u="id",c="data-index",l="data-tie",d="data-tied",f="class",h="name",p={domReady:!1,readyListeners:[],fetched:[],readyFn:function(){n.forEach(this.readyListeners,function(e){setTimeout(e,100)}),this.domReady=!0},insertAfter:function(e,t){var i=e.parentNode;n.forEach(t,function(t){i.insertBefore(t,e.nextSibling),e=t})},remove:function(e){var t=e.parentNode;t&&t.removeChild(e)},removeChildren:function(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)},hasClass:function(e,t){return new RegExp(" "+t+" ").test(" "+e.className+" ")},addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){var n=" "+e.className.replace(/[\t\r\n]/g," ")+" ";if(this.hasClass(e,t)){for(;n.contains(" "+t+" ");)n=n.replace(" "+t+" "," ");e.className=n.replace(/^\s+|\s+$/g,"")}},ready:function(i){if(i){var r=this.readyFn.bind(this);"complete"===t.readyState?(n.nextTick(i),this.domReady=!0):0==this.readyListeners.length&&e.addEventListener("load",r),0==this.readyListeners.length&&e.addEventListener("hashchange",r),this.readyListeners.push(i)}return this.domReady},fetch:function(e,i){i||(this.fetched=[],i=t);var r=i.querySelectorAll(e);n.forEach(r,function(e){this.fetched.push(e)},this)}},v=function(e,t){var i=this,r=t.$name,s=e.tagName,o=function(e){n.debug("Fired '"+e.type+"' listener on '"+r+"' for element "+s);var o=i.value();o=n.trim(o);var a=i.property;t.$prop(a)!==o&&t.$prop(a,o)},a=e.getAttribute(c);this.$=e,this._id=e.getAttribute(u)||n.uid(),this.index=a?parseInt(a):-1,this.tie=e.getAttribute(l)||r,this.property=this.getProperty(this.tie),this.events={},this.isSelect=n.eqi(s,"select"),this.isInput=n.eqi(s,"input")||n.eqi(s,"textarea")||this.isSelect,this.hasCheck=n.eqi(e.type,"radio")||n.eqi(e.type,"checkbox"),this.display=e.style.display,this.shown=!0,this.textEl=null,this.isInput&&(this.hasCheck||this.isSelect?(n.debug("Added change listener on '"+r+"' for element "+s),e.addEventListener("change",o)):"oninput"in e?(n.debug("Added input listener on '"+r+"' for element "+s),e.addEventListener("input",o)):(n.debug("Added keydown listener on '"+r+"' for element "+s),e.addEventListener("keydown",function(e){var t=e.keyCode;91===t||t>15&&19>t||t>=37&&40>=t||o(e)})))};v.prototype={getProperty:function(e){e=n.trim(e||"");var t=e.split("|"),i=t[0],r=i.indexOf(".");return-1!=r?i.substring(r+1):o},isTied:function(){return this.$.getAttribute(d)},setAttribute:function(e,t,i){if(o===e)this.value(t);else if(a===e)this.text(t);else if(f===e)p.addClass(this.$,t);else if(n.isFunction(t)){var r=this.events[e];r&&this.$.removeEventListener(e,r);var s=this;r=function(e){e.index=s.index,e.tie=s.tie,n.safeCall(t,i,e)},this.events[e]=r,this.$.addEventListener(e,r)}else n.isDefined(t)?this.$.setAttribute(e,t):this.$.setAttribute(e,"")},value:function(e){var t=this.$;if(this.hasCheck){if(!n.isDefined(e))return t.checked;e?t.setAttribute("checked","checked"):t.removeAttribute("checked")}else if(this.isSelect){if(!n.isDefined(e))return t.options[t.selectedIndex].value;var i=[].slice.call(t.options);n.forEach(i,function(i,r){return n.isEqual(i.value,e)?(t.selectedIndex=r,!1):!0})}else{if(!this.isInput)return this.text(e);if(!n.isDefined(e))return t.value;t.value=e}return null},text:function(e){var i=this.$;return n.isDefined(e)?(this.isInput?(null==this.textEl&&(this.textEl=t.createElement("span"),this.insertAfter(this.textEl)),this.textEl.textContent=e):this.isSelect?n.forEach(i.options,function(t,r){return n.isEqual(t.text,e)?(i.selectedIndex=r,!1):!0}):i.textContent=e,null):this.isInput?i.nextSibling.textContent||"":this.isSelect?i.options[i.selectedIndex].text:i.textContent||""},html:function(e){var t=this.$;if(n.isDefined(e))this.isInput||this.isSelect||(t.innerHTML=e);else if(!this.isInput&&!this.isSelect)return t.innerHTML||"";return null},remove:function(){var e=this.$;delete this.$,delete this._id,delete this.isInput,delete this.hasCheck,delete this.events,p.remove(e)},insertAfter:function(e){var t=this.$;p.insertAfter(t,e)},show:function(e){this.shown!==e&&(e?(this.$.style.display=this.display,null!=this.textEl&&(this.textEl.style.display=this.display)):(this.display=this.$.style.display,this.$.style.display="none",null!=this.textEl&&(this.textEl.style.display="none")),this.shown=e)}};var g={},y=function(e,t,i,r){var o=g[e];if(n.isUndefined(t))return o;if(o&&o.$sealed)throw new Error(e+" view handle already registered and sealed. Please choose another name for your handle");return o=function(r,a,u,c){return n.debug("Process view handle "+e),n.forEach(i||[],function(e){o[s+e]=g[e]}),t&&n.isFunction(t)&&(a=n.safeCall(t,o,r,a,u,c)),n.debug("Processed view handle "+e),a},n.define(o,e,r,i),o=n.extend(o,n),g[e]=o,o},m=function(e,t,i,s){var o=g[i];if(o&&t._resolved){var a=r+i,u=t[a];n.debug("View handle "+i+" with config "+u);var c=b[t.$tie];n.isDefined(u)&&c&&c.rendered&&(s=s||c.$,t._silent=!0,t[a]=o(t,u,s,e),delete t._silent,t._resolved.contains(i)||t._resolved.push(i),n.forEach(o.$deps,function(n){m(e,t,n,s)}))}},b={},$=function(e,t){n.isUndefined(t.$shown)&&(t.$shown=!0),t.$tie=e.$name,t._resolved=[],this.$=[],this.rendered=!1,this.rendering=!1};$.prototype={register:function(e,t,n,i){var r=g[e];r&&t&&(r.onChange=function(e,n,r,s,o){i&&i!==n||t.call(this,e,n,r,s,o)}),r&&n&&(r.onRender=function(e,t){return n.call(this,e,t)})},select:function(e,t){var i=e.$name,r=[];return(0==p.fetched.length||t)&&p.fetch("["+l+"]",t),n.forEach(p.fetched,function(t){var n=t.getAttribute(l),s=n.charAt(i.length);0!=n.indexOf(i)||""!=s&&" "!=s&&"|"!=s&&"."!=s||r.push(new v(t,e))}),r},$renderAttr:function(e,t,i,r){n.isEnumerable(t)&&(n.debug("Render attribute '"+t+"' with value "+i),r.setAttribute(t,i,e))},$render:function(e,t){var r=e.$name;n.debug("Render "+r,r+" Render"),0==this.$.length&&(this.$=this.select(e),n.debug("Elements selected: "+this.$.length)),n.forEach(e.$deps,function(e){var t=b[e];t.rendered||t.render()});var s=e.$view.$shown;this.$&&n.forEach(this.$,function(o){var a=e;if(o.tie!==r&&(a=i(o.tie,void 0,a),s=a.$view.$shown),t){var u=a.$prop("$view."+t);!u&&e.$view._amap&&(u=a.$prop(t)),u&&this.$renderAttr(e,t,u,o)}else{if(e.$view._amap){var c=[].slice.call(o.$.attributes);n.forEach(c,function(n){t=n.nodeName;var i=a.$prop(t);this.$renderAttr(e,t,i,o)},this)}else n.forIn(a.$view,function(t,n){this.$renderAttr(e,n,t,o)},this);o.setAttribute(d),o.setAttribute(f,r),o.isInput&&o.setAttribute(h,r),o.show(s)}},this),n.debug("Rendered "+r)},inspectChange:function(e,t,s,o,a){var u=e.$name;if(a=a||this.$,n.isHandle(s)){var c=s.indexOf("."),l=s.substring(1,c),d=g[l];d&&n.isFunction(d.onChange)&&d.onChange(e,t,s.substring(c+1),o[r+l],a)}else n.forEach(a,function(n){var r=o[s];if(n.tie!==u){var a=i(n.tie,void 0,e);r=a.$prop(t)}this.$renderAttr(e,s,r,n)},this)}},y("shown",function(e,t,i){return i&&n.forEach(i,function(e){e.show(t)}),t},[],!0),y("parent",function(e,i,r){var s=[];if(n.isString(i))if("#"==i.charAt(0)){var o=b[i.substring(1)];o&&(s=o.$.map(function(e){return e.$}))}else s=[t.getElementById(i)];return n.forEach(s,function(e){p.removeChildren(e),n.forEach(r,function(t){var n=t.$;p.remove(n),e.appendChild(n)})}),i},[],!0);var E=function(e,i,r,s,o){n.forEach(o,function(o){var a=o.$;r&&p.removeChildren(a);var c=t.createDocumentFragment();n.forEach(e,function(e){var r=e._parents[o._id],a=r?t.getElementById(r):null,l=!1;a||(a=t.createElement(e.$tag||"div"),c.appendChild(a),l=!0);var d=new v(a,i);n.forIn(e,function(t,r){n.isHandle(r)?(e.$tie=i.$name,e._resolved=[],m(i,e,r.substring(1),[d])):s.$renderAttr(i,r,t,d)}),l&&(d.setAttribute(u,d._id),e._ids.push(d._id),e._parents[o._id]=d._id)}),n.debug("Processed children"),a.appendChild(c),n.debug("Append children to main")},this)};y("children",function(e,i,r,s){var o=b[s.$name],a=[];if(n.isFunction(i)){var u=0,c=n.safeCall(i,s,u);if(0==i.length&&n.isArray(c))n.forEach(c,function(e){a.push(_(e,s))});else for(;null!=c;)a.push(_(c,s)),c=n.safeCall(i,s,++u)}else n.forEach(i,function(e){a.push(_(e,s))});E(a,s,!0,o,r);var l=function(e,t){return t&&d(t),e._ids||(e=_(e,s)),E(e,s,!1,o,r),e},d=function(e){n.forEach(e._ids,function(e){var n=t.getElementById(e);n&&p.remove(n)})};return a=o.observeArray(a,l,l,d),o.register(this.$name,function(e,i,r,s){n.forEach(s,function(a,u){n.forEach(a._ids,function(n){var a=t.getElementById(n);if(a){var c=new v(a,e);o.inspectChange(e,i,r,s[u],c)}})})}),a},[],!0);var x=function(e){var t=e;return(n.isFunction(e)||n.isArray(e)||n.isRegExp(e)||n.isBoolean(e)||n.isNumber(e)||n.isString(e)||n.isDate(e)||!n.isObject(e))&&(t={value:e}),t._ids=[],t._origins={},t},w=function(t,i){return t=x(t),i=e.tie(i.$name)(),i=n.extend(i,t)},C=function(e,i,r,s,o){n.forEach(o,function(r){var o=r.$,a=t.createDocumentFragment();n.forEach(e,function(e){var c=e._origins[r._id],d=c?t.getElementById(c):null,f=!1;d||(d=o.cloneNode(!0),a.appendChild(d),f=!0);var h=new v(d,i);n.forIn(e.$view,function(e,t){n.isHandle(t)||s.$renderAttr(i,t,e,h)}),f&&(h.setAttribute(u,h._id),h.setAttribute(l),e._ids.push(h._id),e._origins[r._id]=h._id)}),n.debug("Processed repeat"),r.insertAfter(a),r.show(!1),n.debug("Append repeat to main")},this)};y("repeat",function(e,i,r,s){var o=b[s.$name],a=[];if(n.isFunction(i)){var u=0,c=n.safeCall(i,s,u);if(0==i.length&&n.isArray(c))n.forEach(c,function(e,t){a.push(w(e,s,t))});else for(;null!=c;)a.push(w(c,s,u)),c=n.safeCall(i,s,++u)}else n.forEach(i,function(e,t){a.push(w(e,s,t))});C(a,s,!0,o,r);var l=function(e,t){return t&&d(t),e._ids||(e=x(e,s)),C(e,s,!1,o,r),e},d=function(e){n.forEach(e._ids,function(e){var n=t.getElementById(e);n&&p.remove(n)})};return a=o.observeArray(a,l,l,d),o.register(this.$name,function(e,i,r,s){n.forEach(s,function(a,u){n.forEach(a._ids,function(n){var a=t.getElementById(n);if(a){var c=new v(a,e);o.inspectChange(e,i,r,s[u],c)}})})}),a},[],!0);var _=function(e,t){var i=e;if(n.isString(e)&&(e.contains("#")||"*"===e||"@"===e))if(i={},"@"===e)i._amap=!0;else if("*"===e)n.forIn(t,function(e,t){n.isEnumerable(t)&&(i[t]=t.prop())});else{var r=e.split("#"),s=r[0]||o,a=r[1]||o;i[s]=a.prop()}else i=n.isFunction(e)||n.isArray(e)||n.isRegExp(e)||n.isBoolean(e)||n.isNumber(e)||n.isString(e)||n.isDate(e)||!n.isObject(e)?{value:e}:e;return i._ids=[],i._parents={},i};e.tie.handle("view",function(e,t,r,s){var a=this._uid,u=_(t,e);if(s&&!n.isString(t)){var c=_(s,e);u=n.extend(c,u)}var l=new $(e,u),d=e.$name;return l.observeArray=function(){return r.observeArray.apply(r,arguments)},l.render=function(t){this.rendering||!this.rendered&&t||(this.rendering=!0,this.$render(e,t),this.rendering=!1,this.rendered=!0,t||n.forIn(g,function(t,n){u._resolved.contains(n)||m(e,u,n)}))},b[d]=l,r.watch("*",a,function(e,t,s){if("_deleted"===t&&s)delete b[d],r.remove(a);else if(0==t.indexOf("$view.")){var c=t.replace("$view.","");n.isHandle(c)&&!c.contains(".")?m(e,u,c.substring(1)):l.inspectChange(e,t,c,u)}n.isDefined(e.$view.value)&&n.forEach(l.$,function(n){if(t===n.property){var r=s;if(n.tie!==d){var a=i(n.tie,void 0,e);r=a.$prop(t)}l.$renderAttr(e,o,r,n)}})}),p.ready()&&setTimeout(function(){l.rendered||l.render()},100),u},[],!0);var A=function(){n.debug("Render app"),n.forIn(b,function(e){e.rendered||e.render()}),n.debug("Rendered app")};if(p.ready(A),e.tie.domReady=function(){return p.ready.apply(p,arguments)},e.tie.viewHandle=y,"object"==typeof e.exports){var j={};j.q=p,j.el=v,j.renders=b,j.clean=function(){p.fetched=[],j.viewHandlers=g,j.renders=b={}},e.exports=j}}(window),function(e){"use strict";var t=e.tie._,n={type:"GET",mime:"json"},i={script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},r=function(e,n,r,s){r&&(n["Content-Type"]=r),s&&(n.Accept=i[s]),t.forIn(n,function(t,n){e.setRequestHeader(n,t)})},s=function(e,i,r,s,a){return function(){var u=e.xhr;if(4===u.readyState){t.debug("Process response");var c,l,d=u.status;d>=200&&300>d||0===d?l=o(e,r):(l=u.responseText,c=d),!c&&t.isObject(l)&&s===n.type&&a.cache&&a.memo(i,r,l),e.done(l,c)}return null}},o=function(e,t){var i=e.xhr,r=i.responseText;if(r)if(t===n.mime)try{r=JSON.parse(r)}catch(s){e.done(r,s)}else"xml"===t&&(r=i.responseXML);return r},a=function(e,t){this.xhr=e,this.ready=!1,this.fn=t};a.prototype={cancel:function(){this.xhr&&this.xhr.abort(),this.ready=!1,delete this.data,delete this.err},done:function(e,n){this.ready=!0,this.data=e,this.err=n,t.debug("Request ready with response:"+JSON.stringify(e)+" and error:"+n),this.fn?t.safeCall(this.fn,this,e,n):console.log("Response received:"+e)}};var u=function(e,n){if(!e)return e;var i=e.indexOf("?"),r=e.substring(0,-1!=i?i:e.length),s=r.split("/");return t.forEach(s,function(i){if(":"===i.charAt(0)){var r=i.substr(1),s=n[r];t.isDefined(s)?(e=e.replace(i,s),delete n[r]):e=e.replace(i,"")}}),e},c=function(e,n){var i="";n&&(i=n.contains("?")?"&":"?");var r=i;return t.forIn(e,function(e,t){r!==i&&(r+="&"),r+=t+"="+e}),r===i?"":r},l=function(e,i){var r={},s=e.app,o=s&&s.url?s.url:"";if(r.url=/\{url\}/gi.test(o)?o.replace(/\{url\}/gi,e.url||""):e.url?o+e.url:o,!r.url)throw new Error("URL is not defined");var a=s&&s.params?s.params:{};r.params=e.params?t.extend(a,e.params):a,i&&t.extend(r.params,i),r.url=u(r.url,r.params);var c=s&&s.headers?s.headers:{};return r.headers=e.headers?t.extend(c,e.headers):c,r.type=e.type?e.type:s&&s.type?s.type:n.type,r.contentType=e.contentType?e.contentType:s&&s.contentType?s.contentType:null,r.dataType=e.dataType?e.dataType:s&&s.dataType?s.dataType:n.mime,r},d=function(e){var n=null;return t.isFunction(e)?n=e:t.isObject(e)&&(n=function(n,i){i?console.error(i):t.isObject(n)?t.extend(e,n):console.log("Response received:"+n)}),n},f=function(i,o,u,l){var f=i.type,h=i.url,p=i.params,v=i.dataType,g=i.contentType,y=i.headers,m=null;if(t.debug("Ajax call to "+h),f===n.type?(h+=c(p,h),p=null,o.cache&&!l&&(m=o.memo(h,v))):p=c(p),/=\$JSONP/gi.test(h))return o.jsonp(h,p,u,l);var b=new e.XMLHttpRequest,$=new a(b,d(u));if(m)t.debug("Got cached result"),$.done(m,null);else{b.onreadystatechange=s($,h,v,f,o),b.open(f,h),r(b,y,g,v);try{t.debug("Send request"),b.send(p)}catch(E){$.done(null,E)}}return $},h=function(i,r,s,o){var l=i.url,f=i.params,h=e.document.getElementsByTagName("head")[0],p=e.document.createElement("script");l=u(l,f),l+=c(f,l),t.debug("JSONP call to "+l);var v=null;r.cache&&!o&&(v=r.memo(l,n.mime));var g=new a(null,d(s));if(v)t.debug("Got cached result"),g.done(v,null);else{var y="jsonp"+t.uid();e[y]=function(i){return h.removeChild(p),delete e[y],t.debug("Process response"),r.memo(l,n.mime,i),g.done(i,null)},t.debug("Create JSONP request"),p.type="text/javascript",p.src=l.replace(/=\$JSONP/gi,"="+y),h.appendChild(p)}return g},p=function(e,t,n,i){var r=l(e,n);return r.type=t,r.contentType="application/x-www-form-urlencoded",f(r,e,i)},v=function(e,n,i){this.memoize={},this.cache=!0,this.app=i,e&&n&&(t.isString(e)&&(e={url:e}),e.url&&(this.url=e.url),e.params&&(this.params=e.params),e.headers&&(this.headers=e.headers),e.dataType&&(this.dataType=e.dataType),t.isDefined(e.cache)&&(this.cache=e.cache))};v.prototype={jsonp:function(e,t,n,i){var r={};return r.url=e,r.params=t,h(r,this,n,i)},get:function(e,t,i){var r=l(this,e);return r.type=n.type,r.contentType=null,f(r,this,t,i)},post:function(e,t){return p(this,"POST",e,t)},put:function(e,t){return p(this,"PUT",e,t)},"delete":function(e,t){return p(this,"DELETE",e,t)},memo:function(e,n,i){var r=e+n;return t.isDefined(i)&&(this.memoize[r]=i),this.memoize[r]}},e.tie.handle("http",function(e,n,i,r){return new v(n,t.isDefined(e.$http),r)},["view"],!0)}(window),function(e){"use strict";function t(e,t){e&&!i.has(e)?t.$shown=!1:t&&(t.$shown=!0)}var n=e.tie._,i={list:{},init:function(e,t){return n.isEqual(this.list,t)||(this.list=t,this.list.$current={},this.app=e.$$app,n.debug("Routes initialized")),this.list},locate:function(){if(n.isDefined(this.list["/"])){var t=e.location.hash.substring(1);if(t=this.find(t),null==t)this.move("/");else{var r=t.path;n.debug("Process route "+r),n.isFunction(t.handler)&&n.safeCall(t.handler,this.app),this.list.$current=t,this.list.$location=function(e){return e&&i.move(e),t},n.debug("Processed route "+r)}}},find:function(e){if(!e||"/"===e)return{path:"/",handler:this.list["/"]};"/"==e.charAt(e.length-1)&&(e=e.substring(0,e.length-1));
var t=null;return n.forIn(this.list,function(i,r){if(!n.isHandle(r)){var s=r.split("/"),o=e.split("/");if(s.length===o.length&&(n.forEach(s,function(e,t){":"==e.charAt(0)&&(s[t]=o[t])}),s.join("/")===e))return t={path:r,handler:i},!0}return!0}),t},has:function(e){if(n.isArray(e)&&this.list.$current){var t=e.contains("-"),i=!1;return n.forEach(e,function(e){return e.toLowerCase()===this.list.$current.path?(i=!0,!1):!0},this),t!=i}return!0},move:function(t){setTimeout(function(){e.location.hash="#"+t},100)}};e.tie.domReady(function(){i.locate()}),e.tie.handle("route",function(e,n,r,s){return r.watch("\\$route\\.\\$current",this._uid,function(e){var n=e.$view,i=n&&n.$routes;t(i,n)}),i.init(e,s)},["view"],!0),e.tie.viewHandle("routes",function(e,n){return t(n,e),n},["shown"],!0),"object"==typeof e.exports&&(e.exports.routes=i)}(window);