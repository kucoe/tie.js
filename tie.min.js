!function(e){"use strict";function t(e,t,n,i){p.defineImmutable(e,"$name",t),p.defineImmutable(e,"$sealed",n||!1),p.defineImmutable(e,"$deps",Object.freeze(i||[])),p.defineImmutable(e,"_uid",p.uid())}var n="app",i="value",r="$deps",s="$$",o="$",a=null,u={},c={},h={};Array.prototype._=function(e){return p.forEach(this,function(t){e.hasOwnProperty(t)||(e[t]={_item_name:t})}),e};var l=function(e,t){return[].slice.call(e,t)},d=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)},p={debugEnabled:!1,isUndefined:function(e){return void 0==e},isDefined:function(e){return void 0!=e},isObject:function(e){return null!=e&&"object"==typeof e},isString:function(e){return"string"==typeof e||"[object String]"=={}.toString.apply(e)},isNumber:function(e){return"number"==typeof e||"[object Number]"=={}.toString.apply(e)},isDate:function(e){return"[object Date]"=={}.toString.apply(e)},isRegExp:function(e){return"[object RegExp]"=={}.toString.apply(e)},isArray:function(e){return Array.isArray(e)||"[object Array]"=={}.toString.apply(e)},isCollection:function(e){var t={}.toString.apply(e);return this.isArray(e)||e instanceof Array||"[object NodeList]"==t||"[object NamedNodeMap]"==t||"[object Arguments]"==t},isFunction:function(e){return"function"==typeof e},isBoolean:function(e){return"boolean"==typeof e||"[object Boolean]"=={}.toString.apply(e)},trim:function(e){return this.isString(e)?e.replace(/^\s*/,"").replace(/\s*$/,""):e},lowercase:function(e){return this.isString(e)?e.toLowerCase():e},uppercase:function(e){return this.isString(e)?e.toUpperCase():e},toInt:function(e){return parseInt(e,10)},toFloat:function(e){return parseFloat(e)},eqi:function(e,t){return this.lowercase(e)===this.lowercase(t)},isEqual:function(e,t){if(e===t)return!0;if(this.isUndefined(e)||null==e||this.isUndefined(t)||null==t)return!1;if(typeof e!=typeof t)return!1;if(this.isDate(e)&&this.isDate(t))return e.getTime()===t.getTime();if(this.isRegExp(e)&&this.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(this.isFunction(e)&&this.isFunction(t))return e.toString()==t.toString();if(!this.isObject(e)&&!this.isObject(t))return e==t;if(e.prototype!==t.prototype)return!1;try{var n=Object.keys(e),i=Object.keys(t);if(n.length!=i.length)return!1;n.sort(),i.sort();var r;for(r=n.length-1;r>=0;r--)if(n[r]!=i[r])return!1;var s;for(r=n.length-1;r>=0;r--)if(s=n[r],!this.isEqual(e[s],t[s]))return!1}catch(o){return!1}return!0},clone:function(e){if(!e||!this.isObject(e))return e;var t=this.isCollection(e)?[]:Object.create(Object.getPrototypeOf(e));return t=this.extend(t,e,function(e){return p.clone(e)})},convert:function(e,t){var n=e,i=function(e,n){return p.isString(n)&&"#"==n[0]?t[n.substring(1)]:n};return"true"===e?n=!0:"false"===e?n=!1:/^\d+$/.test(e)?n=-1!=e.indexOf(".")?this.toFloat(e):this.toInt(e):"["==e[0]&&"]"==e[e.length-1]?(e=e.replace(/'/g,'"'),n=JSON.parse(e,i)):"{"==e[0]&&"}"==e[e.length-1]?(e=e.replace(/'/g,'"'),n=JSON.parse(e,i)):('"'==e[0]||"'"==e[0])&&(n=e.substring(1,e.length-1)),n},forEach:function(e,t,n,i){if(n||(n=this),t)if(this.isCollection(e)){var r=-1,s=e.length,o=[];for(o=i?[].slice.call(e):e;++r<s&&t.call(n,o[r],r,o)!==!1;);}else t.call(n,e,0,[e]);return e},forIn:function(e,t,n,i){if(n||(n=this),t)for(var r in e)if((e.hasOwnProperty(r)||i)&&t.call(n,e[r],r,e)===!1)break;return e},sequence:function(e,t,n,i){var r=[];if(i||(i=this),t){if(this.isCollection(e))for(var s=-1,o=e.length;++s<o;)r.push(s);else r=Object.keys(e);var a=function(){var s=r.shift();if(0===s||s){var o=e[s];t.call(i,o,a)}else n&&n.call(i,e)};a()}},safeCall:function(e,t,n){var i,r=3;this.isUndefined(n)&&this.isFunction(t.$ready)&&(n=t.$ready(),r=2);try{var s=l(arguments,r);i=e.apply(t,s)}catch(o){i=void 0,n&&(console.error("Is ready and had an error:"+o.message),p.debug(o,"User code error"))}return i},defineImmutable:function(e,t,n){Object.defineProperty(e,t,{value:n,configurable:!1,writable:!1,enumerable:!0,_proxyMark:!0})},uid:function(){return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()},extend:function(e,t,n){return this.isCollection(e)&&this.isCollection(t)?this.forEach(t,function(t,i){[].push.call(e,n?n(t,i):t)}):this.forIn(t,function(t,i){e[i]=n?n(t,i):t},this),e},debug:function(e,t){this.debugEnabled&&(t&&console.groupCollapsed&&(console.groupEnd(),console.groupCollapsed(t)),console.log(e))}},f=function(e){var t=function(t,n,i,r){if(n&&n._proxyMark)return!1;var s=r?r+"."+i:i,o=function(){return n?n.get?n.get.call(t):n.value:e.watcher.onGet(s,e.obj)},a=function(e){var t=o();return!p.isEqual(t,e)},u=function(t){a(t)&&(n&&(n.set?n.set.call(this,t):n.value=t),e.apply(s))},c=n?n.enumerable:!1;return Object.defineProperty(t,i,{get:o,set:u,configurable:!0,enumerable:c,_proxyMark:!0}),!0},i=function(o,u){var c=[],h=e.watcher,l=e.obj,d=l.$ready();return p.forIn(o,function(f,y){if(a.push(y),"prototype"==y)return!0;var v=Object.getOwnPropertyDescriptor(o,y);if(v._proxyMark)return!0;if(!v.configurable||void 0===v.value&&!v.set||v.writable===!1)return!0;var m=0==y.indexOf(s)&&-1!=e.obj.$deps.indexOf(y.substring(2));if(p.isObject(f)&&!m&&y!=r&&y!==s+n&&(p.debug("Exploring "+y),p.extend(c,i(f,y))),p.debug("Observing "+y),t(o,v,y,u)){c.push(y);var g=u?u+"."+y:y;h.onChange(g,l,d)}return!0}),c},o=e.obj,a=[];p.debug("Exploring "+e.name);var u=i(o);return e.newDynamicProps&&(p.forEach(e.newDynamicProps,function(e){p.debug("Observing dynamic property "+e),t(o,null,e)&&u.push(e),a.push(e)}),e.newDynamicProps=[]),p.forEach(e.props,function(t){p.isUndefined(e.obj.$prop(t))&&(p.debug("Notify deleted property "+t),e.watcher.onDelete(t,e.obj))},this),u},y=function(e,n,i,r){var s=c[e];if(p.isUndefined(n))return s;if(s&&s.$sealed)throw new Error(e+" pipe already registered and sealed. Please choose another name for your pipe");if(!e||"."==e[0])throw new Error(e+" is not valid name for your pipe");return s=v(e,n,i||[]),t(s,e,r,i),s=p.extend(s,p),c[e]=s,s},v=function(e,t,n){var i=function(r,o,a){if(p.debug("Process pipe "+e),p.forEach(n,function(e){i[s+e]=c[e]}),o&&o.length>0){var u=p.convert(o,r);o=[],p.forEach(u,function(e){e=p.trim(e),o.push(e)})}return t&&p.isFunction(t)&&(r=p.safeCall(t,i,!0,r,o,a)),p.debug("Ready pipe "+e),r};return i},m=function(e){this.obj=e,this.sequence=[],this.async=!1};m.prototype={next:function(e){if(this.obj=e,this.started=!0,this.sequence.length>0){var t=this.sequence.shift();p.isFunction(t)&&t(e)}},pipe:function(){var e=this;if(0==arguments.length)return e.sequence=[],e.obj;var t=l(arguments);t.push(function(t){e.next(t)});var n=function(n){n=b.apply(n,t),p.isObject(n)?(e.started=!1,e.next(n)):e.async=!0};return e.sequence.push(n),e.async||e.next(e.obj),e.pipe.bind(e)}};var g=function(e){e=p.clone(e);var t=new m(e);return t.pipe.bind(t)},b=function(){var e=arguments[0],t=void 0,n=arguments[arguments.length-1];if(p.isFunction(n)&&(t=n,[].prototype.splice.call(arguments,arguments.length-1)),p.isString(e)){var i=e;if(e=c[e],!e)throw new Error("Pipe "+i+" not found")}else p.isFunction(e)&&(e=y("%tmp%",e));var r=l(arguments,1);return e(this,r,t)},x=function(e,t,n){e=p.trim(e||"");var i=e.split("|"),r=i[0],s=r.indexOf(".");return-1!=s?(i[0]=r.substring(s),r=r.substring(0,s)):i=i.splice(1),n=n?g(n):I(r),p.forEach(i,function(e){var t=x.prototype.parse(e),i=[t.name];i=p.extend(i,t.params),p.debug("Parsed pipe"+JSON.stringify(i)),n=n.apply(n,i)}),p.isFunction(t)?n.apply(n,[t]):n()};x.prototype={parse:function(e){var t=e.indexOf(":"),n={};if(n.name=p.trim(t+1?e.substr(0,t):e),n.params=[],"."==n.name[0]&&(n.params=[n.name.substring(1)],n.name="property",t=-1),t>=0){var i=p.trim(e.substr(++t));i="["+i+"]";var r=p.convert(i,{});p.forEach(r,function(e){e=p.trim(e),n.params.push(e)})}return n}};var w=function(e,n,i,r){var s=h[e];if(p.isUndefined(n))return s;if(s&&s.$sealed)throw new Error(e+" handle already registered and sealed. Please choose another name for your handle");return s=$(e,n,i||[]),t(s,e,r,i),s=p.extend(s,p),h[e]=s,s},$=function(e,t,n){var i=function(r,o,a,u){return p.debug("Process handle "+e),p.forEach(n,function(e){i[s+e]=h[e]}),t&&p.isFunction(t)&&(r=p.safeCall(t,i,!0,r,o,a,u)),p.debug("Ready handle "+e),r};return i},E={$prop:function(e,t){for(var n=this,i=e.split("."),r=1,s=i.length;s>r;)if(n=n[i[r-1]],r++,p.isUndefined(n))return void 0;var o=i[s-1];return p.isUndefined(t)?n[o]:(n[o]=t,void 0)},$ready:function(){var e=!0;return p.forEach(this.$deps,function(t){var n=this[s+t];return!n||n._empty?(e=!1,!1):!0},this),e}},j=function(){p.extend(this,E)};j.prototype=p;var O=function(e){p.extend(this,e)};O.prototype=new j;var C=function(e){this.watchers=[],this.getters=[],this.bind=e,this.handlerId=null};C.prototype={watch:function(e,t,n){if(e&&"*"!==e||(e=".*"),t||n){var i={property:new RegExp("^"+e+"$"),handlerId:this.handlerId,onChange:t,onDelete:n};return this.watchers.push(i),i}return null},add:function(e,t){if(-1==this.bind.props.indexOf(e)&&(this.bind.newDynamicProps.push(e),this.inspect()),this.bind.newDynamicProps.indexOf(e)&&t){var n={property:e,handlerId:this.handlerId,valueFn:t};return this.getters.push(n),n}return null},remove:function(){var e;0==arguments.length&&this.handlerId&&(p.forEach(this.watchers,function(e,t){e.handlerId===this.handlerId&&this.watchers.splice(t,1)},this,!0),p.forEach(this.getters,function(t,n){t.handlerId===this.handlerId&&(this.getters.splice(n,1),e=this.bind.newDynamicProps.indexOf(t.property),-1!=e&&this.bind.newDynamicProps.splice(e,1))},this,!0));var t=arguments[0];p.isString(t)?(p.forEach(this.watchers,function(e,n){(e.property.test(t)||e.handlerId===t)&&this.watchers.splice(n,1)},this,!0),p.forEach(this.getters,function(n,i){(n.property===t||n.handlerId===t)&&(this.getters.splice(i,1),e=this.bind.newDynamicProps.indexOf(t),-1!=e&&this.bind.newDynamicProps.splice(e,1))},this,!0)):(e=this.watchers.indexOf(t),-1!=e&&this.watchers.splice(e,1),e=this.getters.indexOf(t),-1!=e&&(this.getters.splice(e,1),e=this.bind.newDynamicProps.indexOf(t.property),-1!=e&&this.bind.newDynamicProps.splice(e,1)))},onGet:function(e,t,n){n||(n=t.$ready());var i=null;return p.forEach(this.getters,function(r){if(r.property===e){var s=r.valueFn;p.isFunction(s)&&(i=p.safeCall(s,t,n,t,e,i))}}),i},onChange:function(e,t,n){n||(n=t.$ready());var i=t[e];p.forEach(this.watchers,function(r){if(r.property.test(e)){var s=r.onChange;p.isFunction(s)&&p.safeCall(s,t,n,t,e,i)}})},onDelete:function(e,t,n){n||(n=t.$ready()),p.forEach(this.watchers,function(i){if(i.property.test(e)){var r=i.onDelete;p.isFunction(r)&&p.safeCall(r,t,n,t,e)}})},inspect:function(){this.bind&&f(this.bind)}};var S=function(e){this.name=e,this.touch=[],this.props=[],this.newDynamicProps=[],this.processedHandles=[],this.values={},this.applyCount=0,this.timeout=null,this.currentProperty=null,this.watcher=new C(this)};S.prototype={apply:function(e){if(e!==this.currentProperty){if(this.currentProperty=e,this.applyCount++,this.applyCount>10&&p.debug("Too many apply :"+this.name+" - "+this.applyCount),p.debug("Calling apply on '"+this.name+"' after changed property '"+e+"'"),e&&e[0]==o){var t=e.substring(1),n=h[t];n&&this.resolveHandle(this.obj,t,n,this.processedHandles)}if(e&&this.watcher.onChange(e,this.obj),p.forEach(this.touch,function(e){var t=u[e];t&&(t.obj[s+this.name]=this.obj)},this),this.currentProperty=null,!this.timeout){var i=this;this.timeout=setTimeout(function(){i.timeout=null,i.applyCount=0},3e3)}}},resolveHandles:function(){var e=this.name,t=this.obj;e!=n&&(this.processedHandles=[],p.forIn(h,function(e,n){-1==this.processedHandles.indexOf(n)&&this.resolveHandle(t,n,e,this.processedHandles)},this))},resolveHandle:function(e,t,n,i){p.debug("Check handle "+t),p.forEach(n.$deps,function(t){if(-1==i.indexOf(t)){var n=h[t];this.resolveHandle(e,t,n,i)}},this);var r=o+t,s=e[r],u=a?a.obj[r]:void 0;p.isUndefined(s)&&p.isDefined(u)&&(s=u),p.debug("Got handle config "+s),p.isDefined(s)&&(this.currentProperty=r,this.watcher.handlerId=n._uid,this.watcher.remove(),e[r]=n(e,s,this.watcher,u),this.watcher.handlerId=null,this.currentProperty=null),i.push(t)}};var I=function(t,i,r,s){t!=n&&null==u[n]&&e.tie(n,{});var o=u[t];if(p.isUndefined(i))return g(o.obj);if(o&&o.obj.$sealed)throw new Error(t+" tie is already registered and sealed. Please choose another name for your tie");return o=I.prototype.init(t,i,r,s),I.prototype.define(t,o),t==n&&(a=o),o.obj};I.prototype={check:function(e){return(p.isFunction(e)||p.isArray(e)||p.isRegExp(e)||p.isBoolean(e)||p.isNumber(e)||p.isString(e)||p.isDate(e)||!p.isObject(e))&&(e={value:e}),new O(e)},resolveDependencies:function(e,t){var i=e.name;i!=n&&(e.obj[s+n]=a.obj,-1==a.touch.indexOf(i)&&a.touch.push(i)),t&&p.forEach(t,function(t){p.debug("Check dependency "+t);var n=u[t];n||(p.debug("Dependency stub "+t),n={name:t,touch:[],obj:{_empty:!0}},this.define(t,n)),e.obj[s+t]=n.obj,-1==n.touch.indexOf(i)&&n.touch.push(i)},this)},define:function(e,t){var n=u[e];u[e]=t,n&&(n.obj._deleted=!0,n.touch&&(t.touch=n.touch,p.debug("Calling apply on '"+t.name+"' after define"),t.apply("*")))},init:function(e,n,i,r){p.debug("Tie "+e,e);var s=new S(e),o=s.obj=this.check(n);return t(o,e,r,i),o._deleted=!1,s.resolveHandles(),this.resolveDependencies(s,i),s.props=f(s),p.debug("Bind model ready"),s}},e.tie=I,e.tie.pipe=y,e.tie.handle=w,e.tie.enableDebug=function(e){p.debugEnabled=e},e.tie.$=x,e.tie._=p,"object"==typeof e.exports&&(e.exports=function(t){var n=e.tie;return t&&(n.tier=I.prototype,n.util=p,n.model=O,n.ties=u,n.pipesRegistry=c,n.handlesRegistry=h,n.bind=S),n}),y("property",function(e,t){if(t&&t.length>0){var n=t[0],r=t.length>1?t[1]:i;e.$prop(r,e.$prop(n))}return e}),w("require",function(t,n){return p.isFunction(e.require)?e.require(n):console.error("Require is undefined"),n})}("object"==typeof exports?module:window),function(e){"use strict";var t=e.tie._,n=e.document,i="value",r="text",s="data-index",o="data-tie",a="data-tied",u="class",c="name",h={domReady:!1,isListenersSet:!1,readyListeners:[],readyFn:function(){t.forEach(this.readyListeners,function(e){setTimeout(e,100)}),this.domReady=!0},next:function(e,n){var i=e.parentNode;t.forEach(n,function(t){i.insertBefore(t,e.nextSibling),e=t})},remove:function(e){var t=e.parentNode;t&&t.removeChild(e)},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,n){this.hasClass(e,n)||(e.className+=" "+n,e.className=t.trim(e.className))},removeClass:function(e,n){if(this.hasClass(e,n)){var i=new RegExp("(\\s|^)"+n+"(\\s|$)");e.className=e.className.replace(i," "),e.className=t.trim(e.className)}},ready:function(t){return t&&("complete"===n.readyState?(setTimeout(t,0),this.domReady=!0):this.isListenersSet&&e.addEventListener("load",this.readyFn),this.isListenersSet&&(e.addEventListener("hashchange",this.readyFn),this.isListenersSet=!0),this.readyListeners.push(t)),this.domReady}},l=function(e,n){var i=this,r=n.$name,a=e.tagName,u=function(e){t.debug("Fired '"+e.type+"' listener on '"+r+"' for element "+a);var s=i.value();s=t.trim(s);var o=i.getProperty();n.$prop(o)!==s&&n.$prop(o,s)},c=e.getAttribute(s);this.$=e,this._id=t.uid(),this.index=c?parseInt(c):-1,this.tie=e.getAttribute(o),this.obj=n,this.events={},this.isSelect=t.eqi(a,"select"),this.isInput=t.eqi(a,"input")||t.eqi(a,"textarea")||this.isSelect,this.hasCheck=t.eqi(e.type,"radio")||t.eqi(e.type,"checkbox"),this.display=e.style.display,this.shown=!0,this.textEl=null,this.isInput&&(this.hasCheck||this.isSelect?(t.debug("Added change listener on '"+r+"' for element "+a),e.addEventListener("change",u)):"oninput"in e?(t.debug("Added input listener on '"+r+"' for element "+a),e.addEventListener("input",u)):(t.debug("Added keydown listener on '"+r+"' for element "+a),e.addEventListener("keydown",function(e){var t=e.keyCode;91===t||t>15&&19>t||t>=37&&40>=t||u(e)})))};l.prototype={getProperty:function(){var e=this.tie;e=t.trim(e||"");var n=e.split("|"),r=n[0],s=r.indexOf(".");if(-1!=s)return r.substring(s+1);var o=r.indexOf(":"),a=t.trim(o+1?r.substr(0,o):r);if("property"===a&&o>=0){var u=t.trim(r.substr(++o));u="["+u+"]";var c=t.convert(u,{});return c[0]}return i},isTied:function(){return this.$.getAttribute(a)},setAttribute:function(e,n){if(i===e)this.value(n);else if(r===e)this.text(n);else if(u===e)h.addClass(this.$,n);else if(t.isFunction(n)){var s=this.events[e];s&&this.$.removeEventListener(e,s);var o=this;s=function(e){e.index=o.index,e.tie=o.tie,t.safeCall(n,o.obj,o.obj.$ready(),e)},this.events[e]=s,this.$.addEventListener(e,s)}else t.isDefined(n)?this.$.setAttribute(e,n):this.$.setAttribute(e,"")},value:function(e){var n=this.$;if(this.hasCheck){if(!t.isDefined(e))return n.checked;e?n.setAttribute("checked","checked"):n.removeAttribute("checked")}else if(this.isSelect){if(!t.isDefined(e))return n.options[n.selectedIndex].value;var i=[].slice.call(n.options);t.forEach(i,function(i,r){return t.isEqual(i.value,e)?(n.selectedIndex=r,!1):!0})}else{if(!this.isInput)return this.text(e);if(!t.isDefined(e))return n.value;n.value=e}return null},text:function(e){var i=this.$;return t.isDefined(e)?(this.isInput?(null==this.textEl&&(this.textEl=n.createElement("span"),this.next(this.textEl)),this.textEl.textContent=e):this.isSelect?t.forEach(i.options,function(n,r){return t.isEqual(n.text,e)?(i.selectedIndex=r,!1):!0}):i.textContent=e,null):this.isInput?i.nextSibling.textContent||"":this.isSelect?i.options[i.selectedIndex].text:i.textContent||""},html:function(e){var n=this.$;if(t.isDefined(e))this.isInput||this.isSelect||(n.innerHTML=e);else if(!this.isInput&&!this.isSelect)return n.innerHTML||"";return null},remove:function(){var e=this.$;delete this.$,delete this.obj,delete this._id,delete this.isInput,delete this.hasCheck,delete this.events,h.remove(e)},next:function(e){var t=this.$;h.next(t,e)},show:function(e){this.shown!==e&&(e?(this.$.style.display=this.display,null!=this.textEl&&(this.textEl.style.display=this.display)):(this.display=this.$.style.display,this.$.style.display="none",null!=this.textEl&&(this.textEl.style.display="none")),this.shown=e)}};var d=function(e,n,i){var r=this.name,s=this.value,o=this.property;if(t.isUndefined(i)&&(i=e.$ready()),t.isFunction(s))return t.safeCall(s,e,i);if(o&&t.isUndefined(s))return p(e,o,n);if(!r)throw new Error("Where is your property?");return p(e,r,n)},p=function(e,n,r){t.isUndefined(r)&&(r=-1);var s=e.$values;return r>=0&&s&&t.isDefined(s[r][n])?s[r][n]:r>=0&&s&&i==n?s[r]:e.$prop(n)},f=function(e,n){if(this.$attrs){var i=this.$attrs[e];if(t.isUndefined(n)){if(i)return i.val(this)}else i&&i.property?this.$prop(i.property,n):i&&this.$prop(e,n)}return null},y=function(e){var t=e.name,n=t.indexOf("#");return-1!=n?(e.name=t.substring(0,n),e.property=t.substring(n+1),e.deps.push(e.property)):e.deps.push(t),e},v=e.tie.$,m={},g=function(e){this.obj=e,t.isUndefined(e.$shown)&&(e.$shown=!0),e.$attr=f,this.values={},this.rendered=!1,this.rendering=!1,this.loaded=!1,this.loading=!1,this.selected=!1,this.e=0,this.$=[]};g.prototype={prepareAttrs:function(e,n,r){if(e&&t.isArray(e)){var s={},o=this;t.forEach(e,function(e){t.isString(e)&&(e={name:e,property:null,deps:[],value:null,val:d},e=y(e));var a=e.name;if(i===a&&t.isFunction(n.value)&&(e.value=n.value,delete n.value),(e.property||e.value)&&(r.add(a,function(e){return e.$attr(a)}),r.watch(a,function(e,t,n){e.$attr(a,n)})),e.deps.length>0){var u=e.deps.join("|");r.watch(u,function(){o.render(a)})}s[a]=e}),e=s}return e},query:function(e,n,i,r){var s=r.querySelectorAll(e);return t.forEach(s,function(e){i.push(new l(e,n))}),i},select:function(e){var t=this.obj,i=t.$name,r=[];return e||(e=n),r=this.query("["+o+'="'+i+'"]',t,r,e),r=this.query("["+o+'^="'+i+'|"]',t,r,e),r=this.query("["+o+'^="'+i+' |"]',t,r,e),r=this.query("["+o+'^="'+i+'."]',t,r,e),t.selected=!0,r},load:function(){this.loading||(this.loading=!0,this.selected||(this.$=this.select(),this.e=this.$.length,t.debug("Elements selected: "+this.$.length)),this.loaded=!0,this.loading=!1)},renderView:function(){if(this.obj.$view&&this.e>0){var e=this.viewHtml();e&&t.forEach(this.$,function(t){t&&t.html(e)})}},viewHtml:function(){var e=this.obj.$view,n=m[e.name],i="";return n&&(n.loaded||n.load(),t.forEach(n.$,function(e){e&&(i+=e.html())})),i},renderAttr:function(e,n,i,r,s){var o=e.name,a=e.val(n,i,r);t.debug("Render attribute '"+o+"' with value "+a),s.setAttribute(o,a)},render:function(e,n){if(this.rendered||!e||n){var i=this.obj;if(!this.rendering||n){this.rendering=!0;var r=i.$name;t.debug("Render "+r,r+" Render"),this.loaded||this.load();var s=i.$ready();t.forEach(this.$,function(o){if(o&&(!o.isTied()||n))if(i.$shown){i=v(o.tie,void 0,i);var h=i.$attrs,l=o.index;if(h)if(e){var d=h[e];d&&this.renderAttr(d,i,l,s,o)}else t.forIn(h,function(e){this.renderAttr(e,i,l,s,o)},this),o.setAttribute(a),o.setAttribute(u,r),o.isInput&&o.setAttribute(c,r)}else o.show(i.$shown)},this),this.rendering=!1,this.rendered=!0,t.debug("Rendered "+r)}}},show:function(e){this.rendered&&t.forEach(this.$,function(t){t&&t.show(e)},this)}};var b=e.tie.handle,x=function(){t.debug("Render app"),t.forIn(m,function(e){e.rendered||(e.render(),e.renderView())}),t.debug("Rendered app")},w=function(e,t,n){var i=new g(e);return m[e.$name]=i,t.watch("_deleted",function(e,i,r){r&&(delete m[e.$name],t.remove(n))}),h.ready()&&setTimeout(function(){i.render(),i.renderView()},100),i};b("attr",function(){return f},["attrs"],!0),b("attrs",function(e,t,n){if(t){var i=w(e,n,this._uid);t=i.prepareAttrs(t,e,n)}return t},["view"],!0),b("shown",function(e,t){var n=m[e.$name];return n&&n.show(t),t},["attrs"],!0),b("view",function(e,n,i,r){if(t.isString(n)&&(n={name:n,url:r?r.url:""}),!n.name)return void 0;var s=m[e.$name];return s&&h.ready()&&s.rendered&&setTimeout(function(){s.renderView()},100),n},[],!0),h.ready(x),e.tie.domReady=h.ready,e.tie.attr=function(e,t,n){var i={name:e,property:null,deps:n||[],value:t,val:d};if(t&&-1!=e.indexOf("#"))throw new Error("Property and calculated value combination is not supported");return t||(i=y(i)),i},"object"==typeof e.exports&&(e.exports=function(){var e={};return e.q=h,e.el=l,e.renders=m,e.clean=function(){e.renders=m={}},e})}(window),function(e){"use strict";var t=e.tie._,n={type:"GET",mime:"json"},i={script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},r=function(e,n,r,s){r&&(n["Content-Type"]=r),s&&(n.Accept=i[s]),t.forIn(n,function(t,n){e.setRequestHeader(n,t)})},s=function(e,i,r,s,a){return function(){var u=e.xhr;if(4===u.readyState){t.debug("Process response");var c,h,l=u.status;l>=200&&300>l||0===l?h=o(e,r):(h=u.responseText,c=l),!c&&t.isObject(h)&&s===n.type&&a.cache&&a.memo(i,r,h),e.done(h,c)}return null}},o=function(e,t){var i=e.xhr,r=i.responseText;if(r)if(t===n.mime)try{r=JSON.parse(r)}catch(s){e.done(r,s)}else"xml"===t&&(r=i.responseXML);return r},a=function(e,t){this.xhr=e,this.ready=!1,this.fn=t};a.prototype={cancel:function(){this.xhr&&this.xhr.abort(),this.ready=!1,delete this.data,delete this.err},done:function(e,n){this.ready=!0,this.data=e,this.err=n,t.debug("Request ready with response:"+e+" and error:"+n),this.fn?t.safeCall(this.fn,this,!0,e,n):console.log("Response received:"+e)}};var u=function(e,n){if(!e)return e;var i=e.indexOf("?"),r=e.substring(0,i+1?i:e.length),s=r.split("/");return t.forEach(s,function(i){if(":"===i[0]){var r=i.substr(1),s=n[r];t.isDefined(s)&&(e.replace(i,s),delete n[r])}}),e},c=function(e,n){var i="";n&&(i=n.indexOf("?")+1?"&":"?");var r=i;return t.forIn(e,function(e,t){r!==i&&(r+="&"),r+=t+"="+e}),r===i?"":r},h=function(e,i){var r={},s=e.app,o=s&&s.url?s.url:"";if(r.url=/\{url\}/gi.test(o)?o.replace(/\{url\}/gi,e.url||""):e.url?o+e.url:o,!r.url)throw new Error("URL is not defined");var a=s&&s.params?s.params:{};r.params=e.params?t.extend(a,e.params):a,i&&t.extend(r.params,i),r.url=u(r.url,r.params);var c=s&&s.headers?s.headers:{};return r.headers=e.headers?t.extend(c,e.headers):c,r.type=e.type?e.type:s&&s.type?s.type:n.type,r.contentType=e.contentType?e.contentType:s&&s.contentType?s.contentType:null,r.dataType=e.dataType?e.dataType:s&&s.dataType?s.dataType:n.mime,r},l=function(e){var n=null;return t.isFunction(e)?n=e:t.isObject(e)&&(n=function(n,i){i?console.error(i):t.isObject(n)?t.extend(e,n):console.log("Response received:"+n)}),n},d=function(i,o,u,h){var d=i.type,p=i.url,f=i.params,y=i.dataType,v=i.contentType,m=i.headers,g=null;if(t.debug("Ajax call to "+p),d===n.type?(p+=c(f,p),f=null,o.cache&&!h&&(g=o.memo(p,y))):f=c(f),/=\$JSONP/gi.test(p))return o.jsonp(p,f,u,h);var b=new e.XMLHttpRequest,x=new a(b,l(u));if(g)t.debug("Got cached result"),x.done(g,null);else{b.onreadystatechange=s(x,p,y,d,o),b.open(d,p),r(b,m,v,y);try{t.debug("Send request"),b.send(f)}catch(w){x.done(null,w)}}return x},p=function(i,r,s,o){var h=i.url,d=i.params,p=e.document.getElementsByTagName("head")[0],f=e.document.createElement("script");h=u(h,d),h+=c(d,h),t.debug("JSONP call to "+h);var y=null;r.cache&&!o&&(y=r.memo(h,n.mime));var v=new a(null,l(s));if(y)t.debug("Got cached result"),v.done(y,null);else{var m="jsonp"+t.uid();e[m]=function(i){return p.removeChild(f),delete e[m],t.debug("Process response"),r.memo(h,n.mime,i),v.done(i,null)},t.debug("Create JSONP request"),f.type="text/javascript",f.src=h.replace(/=\$JSONP/gi,"="+m),p.appendChild(f)}return v},f=function(e,t,n,i){var r=h(e,n);return r.type=t,r.contentType="application/x-www-form-urlencoded",d(r,e,i)},y=function(e,n,i){this.memoize={},this.cache=!0,this.app=i,e&&n&&(e.url&&(this.url=e.url),e.params&&(this.params=e.params),e.headers&&(this.headers=e.headers),e.dataType&&(this.dataType=e.dataType),t.isDefined(e.cache)&&(this.cache=e.cache))};y.prototype={jsonp:function(e,t,n,i){var r={};return r.url=e,r.params=t,p(r,this,n,i)},get:function(e,t,i){var r=h(this,e);return r.type=n.type,r.contentType=null,d(r,this,t,i)},post:function(e,t){return f(this,"POST",e,t)},put:function(e,t){return f(this,"PUT",e,t)},"delete":function(e,t){return f(this,"DELETE",e,t)},memo:function(e,n,i){var r=e+n;return t.isDefined(i)&&(this.memoize[r]=i),this.memoize[r]}};var v=e.tie.handle;v("http",function(e,n,i,r){return new y(n,t.isDefined(e.$http),r)},["attrs"],!0)}(window);