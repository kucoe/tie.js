(function(e){function t(e){for(var t={},n=e.split(","),r=0;n.length>r;r++)t[n[r]]=!0;return t}var n=/^<([-A-Za-z0-9_]+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,r=/^<\/([-A-Za-z0-9_]+)[^>]*>/,i=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,s=t("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),o=t("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),a=t("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),u=t("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),c=t("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),l=t("script,style"),d=function(e,t){function d(e,n,r,l){if(n=n.toLowerCase(),o[n])for(;g.last()&&a[g.last()];)f("",g.last());if(u[n]&&g.last()==n&&f("",n),l=s[n]||!!l,l||g.push(n),t.start){var d=[];r.replace(i,function(e,t){var n=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:c[t]?t:"";d.push({name:t,value:n,escaped:n.replace(/(^|[^\\])"/g,'$1\\"')})}),t.start&&t.start(n,d,l)}}function f(e,n){if(n)for(r=g.length-1;r>=0&&g[r]!=n;r--);else var r=0;if(r>=0){for(var i=g.length-1;i>=r;i--)t.end&&t.end(g[i]);g.length=r}}var h,p,v,g=[],m=e;for(g.last=function(){return this[this.length-1]};e;){if(p=!0,g.last()&&l[g.last()])e=e.replace(RegExp("(.*)</"+g.last()+"[^>]*>"),function(e,n){return n=n.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1"),t.text&&t.text(n),""}),f("",g.last());else if(0==e.indexOf("<!--")?(h=e.indexOf("-->"),h>=0&&(e=e.substring(h+3),p=!1)):0==e.indexOf("</")?(v=e.match(r),v&&(e=e.substring(v[0].length),v[0].replace(r,f),p=!1)):0==e.indexOf("<")&&(v=e.match(n),v&&(e=e.substring(v[0].length),v[0].replace(n,d),p=!1)),p){h=e.indexOf("<");var b=0>h?e:e.substring(0,h);e=0>h?"":e.substring(h),t.text&&t.text(b)}if(e==m)throw"Parse Error: "+e;m=e}f()},f=function(e){var t=[],n=[];return d(e,{start:function(e,t){for(var r={$tag:e,$children:[]},i=0;t.length>i;i++)r[t[i].name]=t[i].value;n.push(r)},end:function(){var e=n.pop();0==e.$children.length&&delete e.$children,0==n.length?t.push(e):n[n.length-1].$children.push(e)},text:function(e){var t=n[n.length-1];t&&(t.value=e)}}),t};e.tie.pipe("html",function(e,t){return e.$view.$children=f(t[0]),e})})("object"==typeof exports?module:window);